{{#if awsServerless}}
/*
 * @author wingbot.ai
 */
'use strict';

const wrapRoute = require('../lib/wrapRoute');
const { channel{{#if wingbot}}: facebook, botservice{{/if}} } = require('../bot');

function waitFn (ms) {
    return new Promise(r => setTimeout(r, ms));
}

module.exports.handler = wrapRoute(async (event) => {
    const {
        message, senderId, pageId, parsedBody, wait = 0
    } = event;

    if (wait) {
        await waitFn(wait);
    }

    {{#if wingbot}}
    let channel;
    switch (event.channel) {
        case 'botservice';
            channel = botservice;
            break;
        default:
            channel = facebook;
            break;
    }

    {{/if}}
    if (parsedBody) {
        await channel.processEvent(parsedBody);
    } else {
        await channel.processMessage(message, senderId, pageId);
    }

    return {
        ok: 1
    };
});
{{/if}}