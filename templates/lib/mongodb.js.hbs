{{#if isMongoOrCosmos}}
/*
 * @author wingbot.ai
 */
'use strict';

const { MongoClient } = require('mongodb');
const config = require('../config');

let connection;

async function getDatabase (disconnect = false) {
    if (disconnect && !connection) {
        return null;
    }

    if (disconnect) {
        await (await connection).close();
        connection = null;
        return null;
    }

    if (!connection) {
        const cs = await Promise.resolve(config.db.url);
        connection = MongoClient.connect(cs, config.db.options);
    }

    const c = await connection;
    return c.db(config.db.db);
}

module.exports = getDatabase;
{{/if}}
